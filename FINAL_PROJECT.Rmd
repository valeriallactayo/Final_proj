---
title: "Proyecto de fin de semestre"
subtitle: "Analisis de incendios forestales"

date: "Septiembre 2021"
output: 
html_document:
  toc: true
  toc_depth: 5
  toc_float: 
  collapsed: false
  smooth_scroll: true
header-includes:
  - \renewcommand{\and}{\\}
---

Alumno | Código
-- | --
Valeria Llactayo Peña | 17160046
Joaquin Romualdo Peña | 17150052
Javier Sullcaray Barrientos | 17160200
Jose Victorio Gonzales | 17160051
Daniel Yauri Leiva | 17160208

> En el presente trabajo se muestra el proceso de manipulación de datos de incendios forestales.

```{r }
#Comenzaremos subiendo los datos que usaremos
load("workspace.Rdata")
```
## LIBRERÍAS UTILIZADAS
pacman :: p_load(tidyverse, 
                 lattice, 
                 psych, 
                 PerformanceAnalytics, 
                 GGally, 
                 cptcity,
                 library(factoextra))

## ANÁLISIS EXPLORATORIO DE DATOS

## ANÁLISIS DE COMPONENTES PRINCIPALES

```{r}
fires <- read_csv("forestfires.csv") %>% 
  print()
```

```{r}
fires %>% select(-c("X", "Y", "day"))
```

```{r}
fires_pca <- select(fires, 5:13) %>% 
  print()
```

#describiendo los datos
```{r}
describe(fires_pca)
```

#esttandarizando
```{r}
fires_pca_esc <- scale(fires_pca) %>% as_tibble() %>% 
  print()
```

#matriz de correlación

```{r}
correlation <- cor(fires_pca_esc)
```

#matriz de varianza-covarianza

```{r}
matrix_cov <- cov(fires_pca_esc)
```

#suma de la diagonal o "varianza total"

```{r}
diag(matrix_cov) %>% sum() 
```

```{r}
chart.Correlation(fires_pca_esc, histogram = T, pch = 20)
```

```{r}
levelplot(
  correlation,
  col.regions = 
    cpt(
      pal = "cb_div_RdBu_11", n = 100
    )
)
```

#calculando eigenvectors y eigenvalues

```{r}
eigen <- eigen(matrix_cov) %>% print()
```

#calculando el pca

```{r}
library(ade4)
pca <- dudi.pca(fires_pca_esc, 
                scale = F, 
                scannf = F,
                nf = ncol(fires_pca_esc)
)
```

```{r}
summary(pca)
```

```{r}
pca$eig
```

```{r}
sum(pca$eig)
```

#autovectores
```{r}
pca$c1
```


```{r}
fviz_eig(pca,addlabels = T)
```

## CLUSTER JERARQUICO

#Matriz de distancias
```{r}
distancia<- dist(pca_data, method = "euclidean")
d <- as.matrix(distancia)
```

#Heatmap
```{r}
heatmap(d)
fviz_dist(dist.obj = distancia, lab_size = 10, 
          gradient = list(low = "#FC4E07", mid = "white", high = "#00AFBB"))
```

#clusterizando con el metodo ward
```{r}
hmodel<- hclust(distancia, method = "ward.D")
```

#dendograma
```{r}
plot(hmodel)
```

#obteniendo las alturas
```{r}
names <- "height"
heights <- as.data.frame(hmodel$height) #hay 28 alturas
```

#ploteando las alturas
```{r}
ggplot(heights, aes(x = index(heights), y = hmodel$height)) +
  geom_line(color = "royalblue2",    # Color de la linea
            lwd = 1,      # Ancho de la linea
            linetype = 1) +
  geom_vline(xintercept=30, color = "orange") +
  geom_point(color = "royalblue4")+ labs( x = "Observaciones", y = "Altura",
          title ="VisualizaciÃ³n de alturas")+
  theme(plot.title = element_text(hjust = 0.5))
```

#Obteniendo el valor de la altura
```{r}
(hmodel$height)[30]
```

#cortando el dendograma
```{r}
clust<- cutree(hmodel, k = 3)
length(clust)
```

#numero de elementos en cada cluster
```{r}
table(clust)
```

#visualizando los grupo en el dendograma
```{r}
fviz_dend(hmodel, k = 3, # Cortar en 4 grupos
          cex = 0.5, # Tamaño de las etiquetas
          k_colors = c("#2E9FDF", "#00AFBB", "#E7B800"),
          color_labels_by_k = TRUE, # color labels by groups
          rect = TRUE, # Add rectangle around groups
          rect_border = c("#2E9FDF", "#00AFBB", "#E7B800"),
          rect_fill = TRUE)
```

#visualizando los grupos
```{r}
fviz_cluster(list(data = pca_data, cluster = clust),
             palette = c("#2E9FDF", "#00AFBB", "#E7B800"),
             ellipse.type = "convex", # Concentration ellipse
             repel = TRUE, # Avoid label overplotting (slow)
             show.clust.cent = TRUE, ggtheme = theme_minimal()
)
```

```{r}
library(cluster)
```

#boxplot, caracterizacion de clusters
```{r}
col <- c("#2E9FDF", "#00AFBB", "#E7B800")
data2 <- dplyr::bind_cols(pca_data, cluster = as.numeric(clust))
```

#visualizando en 3d
```{r}
library(plotly)
hmodel3d <- plot_ly(data2, x = ~Axis1, y = ~Axis2, z = ~Axis3,
               marker = list(color = ~cluster, colorscale = c('#FFE1A1', '#683531'), showscale = FALSE))
print(fig)
```
